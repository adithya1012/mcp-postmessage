<!DOCTYPE html>
<html>
  <head>
    <title>MCP PostMessage Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      .log {
        background: #f0f0f0;
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
      }
      .error {
        background: #ffe6e6;
      }
      .success {
        background: #e6ffe6;
      }
      iframe {
        width: 100%;
        height: 400px;
        border: 1px solid #ccc;
        margin: 10px 0;
      }
    </style>
  </head>
  <body>
    <h1>MCP PostMessage Connection Test</h1>

    <div id="logs"></div>

    <h2>AI Copilot iframe:</h2>
    <iframe id="testIframe" src="/inverted/ai-copilot"></iframe>

    <button onclick="testConnection()">Test Connection</button>
    <button onclick="clearLogs()">Clear Logs</button>

    <script>
      function log(message, type = "info") {
        const logs = document.getElementById("logs");
        const div = document.createElement("div");
        div.className = `log ${type}`;
        div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        logs.appendChild(div);
        console.log(message);
      }

      function clearLogs() {
        document.getElementById("logs").innerHTML = "";
      }

      function testConnection() {
        log("Starting connection test...");

        const iframe = document.getElementById("testIframe");

        // Listen for messages from iframe
        window.addEventListener("message", (event) => {
          log(
            `Received message from iframe: ${JSON.stringify(event.data)}`,
            "success"
          );
        });

        // Test sending a message to iframe
        setTimeout(() => {
          log("Sending test message to iframe...");
          if (iframe.contentWindow) {
            iframe.contentWindow.postMessage(
              {
                type: "test",
                message: "Hello from parent",
              },
              "*"
            );
          } else {
            log("iframe contentWindow not available", "error");
          }
        }, 2000);
      }

      // Auto-test when iframe loads
      document.getElementById("testIframe").addEventListener("load", () => {
        log("iframe loaded successfully", "success");
        setTimeout(testConnection, 1000);
      });

      log("Test page loaded");
    </script>
  </body>
</html>
